import{i as Ve,l as ze,r as De,b as Fe,L as Me,_ as U,T as Oe,P as je,K as Re,M as Be,N as Ue,O as He,__tla as Ke}from"./_plugin-vue_export-helper-B7AYZ_fF.js";import{l as q}from"./logger-BTW-zIW3.js";import{V as Ne}from"./index-DQMxDuq3.js";import{d as Z,b as H,a as Xe}from"./constant-CWUMdlVX.js";import{i as _,a as ee,q as K,u as W,v as b,x as f,y as w,C as T,z as $,A as x,F as Ye,r as E,w as V,S as te,J as S,K as I,E as z,M as D,Q as F,B as N,G as Ge,H as Je,D as Qe,T as Ze,n as et}from"./runtime-core.esm-bundler-CuuCWbwv.js";import{_ as tt}from"./lib-FVFXNsp8.js";import{__tla as ot}from"./build-6XnEkjQY.js";import{__tla as rt}from"./oxide_parser_wasm-8nf_WcM4.js";import{g as at}from"./intellisense-DggKt6it.js";import{a as lt}from"./index-BtL5O8vF.js";import{s as nt}from"./set-qX46P2hw.js";import"./index-BHzFOpFs.js";import"./isObject-B5R9K1Pz.js";import"./preload-helper-Tcd9XBoB.js";import"./_MapCache-C7aBjWBU.js";import"./isSymbol-DJmTqBMq.js";Promise.all([(()=>{try{return Ke}catch{}})(),(()=>{try{return ot}catch{}})(),(()=>{try{return rt}catch{}})()]).then(async()=>{Ve({scope:"#windpressbricks-variable-app",rootSize:10}),ze.add(De,Fe);const oe={id:"windpressbricks-variable-app-header",class:"bg:$(builder-bg) cursor:grab bb:1|solid|$(builder-border-color)"},re={class:"flex gap:10 align-items:center px:12 py:8"},ae=["href"],le={class:"font:bold flex gap:10 align-items:center cursor:default"},ne={__name:"PanelHeader",setup(a){const t=_("variableApp"),o=_("isOpen");function m(){const s=t.querySelector("#windpressbricks-variable-app-header");let p=E(!1),g=0,d=0;V(p,n=>{n?(document.body.style.userSelect="none",Z.style.pointerEvents="none",s.style.cursor="grabbing"):(document.body.style.removeProperty("user-select"),Z.style.removeProperty("pointer-events"),s.style.cursor="grab")});const i=n=>{p.value=!0;const l=s.getBoundingClientRect();g=n.clientX-l.left,d=n.clientY-l.top};s.removeEventListener("mousedown",i),s.addEventListener("mousedown",i);const u=n=>{if(!p.value)return;const l=s.getBoundingClientRect(),e=n.clientX,r=n.clientY,v=e-g,c=r-d,y=v<0?0:v>window.innerWidth-l.width?window.innerWidth-l.width:v,k=c<0?0:c>window.innerHeight-l.height?window.innerHeight-l.height:c;t.style.left=`${y}px`,t.style.top=`${k}px`};document.removeEventListener("mousemove",u),document.addEventListener("mousemove",u);const h=n=>{p.value=!1};document.removeEventListener("mouseup",h),document.addEventListener("mouseup",h)}return ee(()=>{m()}),(s,p)=>{const g=K("inline-svg"),d=K("font-awesome-icon"),i=W("tooltip");return b(),f("div",oe,[w("div",re,[T((b(),f("a",{href:s.windpressbricks.site_meta.admin_url,target:"_blank",class:"flex align-items:center fg:$(builder-color-accent):hover"},[$(g,{src:x(Me),class:"inline-svg fill:current font:24"},null,8,["src"])],8,ae)),[[i,{placement:"top",content:"Open WindPress plugin"}]]),T((b(),f("div",le,[Ye(" WindPress ")])),[[i,{placement:"top",content:`v${s.windpressbricks._version}`}]]),T((b(),f("button",{onClick:p[0]||(p[0]=u=>o.value=!x(o)),class:"ml:auto p:6 bg:transparent bg:$(builder-bg-accent):hover r:$(builder-border-radius)"},[$(d,{icon:["fas","xmark"],class:"fg:$(builder-color)"})])),[[i,{placement:"top",content:"Close"}]])])])}}},se={class:"flex-grow:1"},ie={key:0,class:"expansion-panel__body"},ce={__name:"ExpansionPanel",props:{namespace:{type:String,required:!0},name:{type:String,required:!0}},setup(a,{expose:t}){const o=a,m=E(null),s=lt(`windpressbricks-variable-app.ui.expansion-panels.${o.namespace}`,{[`${o.name}`]:!1},void 0,{mergeDefaults:!0});function p(d){s.value[o.name]=d===null?!s.value[o.name]:d}function g(){m.value.scrollIntoView()}return t({togglePanel:p,scrollIntoView:g}),(d,i)=>{const u=K("font-awesome-icon");return b(),f("div",{ref_key:"sectionRef",ref:m,class:"expansion-panel m:10 mr:4"},[w("div",{onClick:i[0]||(i[0]=h=>x(s)[a.name]=!x(s)[a.name]),class:S([{"bg:$(builder-bg-3)!":x(s)[a.name]},"expansion-panel__header flex bg:$(builder-bg-2) bg:$(builder-bg-3):hover justify-content:space-between p:10 r:8 cursor:pointer"])},[w("div",se,[te(d.$slots,"header",{},void 0,!0)]),w("div",null,[$(u,{icon:["fas","chevron-right"],class:S([{"rotate(-90)":x(s)[a.name]},"~duration:300 font:18"])},null,8,["class"])])],2),$(Oe,null,{default:I(()=>[x(s)[a.name]?(b(),f("div",ie,[te(d.$slots,"default",{},void 0,!0)])):z("",!0)]),_:3})],512)}}},M=U(ce,[["__scopeId","data-v-37676007"]]),ue={class:"{m:10;pb:15}>div bb:1|solid|$(builder-border-color)>div:not(:last-child)"},pe={class:"variable-section-title font:14 my:10"},de={class:"variable-section-items flex flex:row gap:8 flex-wrap:wrap"},ve=["onClick","onMouseenter"],be={class:"font:14"},me=1e3,X={__name:"CommonVariableItems",props:{variableItems:{type:Object,required:!0}},setup(a){const t=_("focusedInput"),o=_("recentVariableSelectionTimestamp"),m=_("tempInputValue");function s(d,i){performance.now()-o.value<me||t.value&&(t.value.value=`var(${i})`,t.value.dispatchEvent(new Event("input")),t.value.focus())}function p(d){!t.value||m.value===null||(t.value.value=m.value,t.value.dispatchEvent(new Event("input")),t.value.focus())}function g(d,i){t.value&&(t.value.value=`var(${i})`,t.value.dispatchEvent(new Event("input")),t.value.focus(),m.value=`var(${i})`,o.value=performance.now())}return(d,i)=>{const u=W("tooltip");return b(),f("div",ue,[(b(!0),f(D,null,F(a.variableItems,(h,n)=>(b(),f("div",{key:n,class:""},[w("div",pe,N(n.replace("_","-")),1),w("div",de,[h.length>0?(b(!0),f(D,{key:0},F(h,(l,e)=>T((b(),f("button",{key:e,onClick:r=>g(r,l.key),onMouseenter:r=>s(r,l.key),onMouseleave:p,class:"px:12 py:8 r:$(builder-border-radius) fg:$(builder-color) bg:$(builder-bg-2) bg:$(builder-bg-3):hover {opacity:.5;font:semibold}>span opacity:100:hover>span"},[w("span",be,N(l.label),1)],40,ve)),[[u,{placement:"top",content:`var(${l.key}, ${l.value})`}]])),128)):z("",!0)])]))),128))])}}};function O(){var t,o;if(H.$_state.activePanel!=="element")return null;const a=(t=H.$_state)==null?void 0:t.activeElement.id;return(o=H.$_getIframeDoc())==null?void 0:o.getElementById(`brxe-${a}`)}function fe({selector:a,callback:t,options:o}){const m=new MutationObserver(t),s=document.querySelector(a);if(!s){q(`Target not found for selector: ${a}`,{module:"variable-picker",type:"error"});return}const p={childList:!0,subtree:!0};m.observe(s,Object.assign(Object.assign({},p),o))}const ye={class:"{m:10;pb:15}>div bb:1|solid|$(builder-border-color)>div:not(:last-child)"},ge={class:"variable-section-title font:14 my:10"},he={key:0,class:"variable-section-items"},ke=["onClick","onMouseenter"],we=["onClick","onMouseenter"],_e=1e3,$e={__name:"ColorVariableItems",props:{variableItems:{type:Object,required:!0}},setup(a){const t=_("focusedInput"),o=_("recentColorPickerTarget"),m=_("recentVariableSelectionTimestamp"),s=_("tempInputValue");function p(n,l){var e;if(!(performance.now()-m.value<_e)){if(!t.value){const r=O();if(!r)return;const v=[{property:"color",control:"typography"},{property:"backgroundColor",control:"background"},{property:"borderColor",control:"border"}];for(const{property:c,control:y}of v)(e=o.value)!=null&&e.closest(`[data-control="${y}"]`)&&(r.style[c]=`var(${l})`);return}t.value.value=`var(${l})`,t.value.dispatchEvent(new Event("input")),t.value.focus()}}function g(n){var l;if(!t.value||s.value===null){const e=O();if(!e)return;const r=[{property:"color",control:"typography"},{property:"backgroundColor",control:"background"},{property:"borderColor",control:"border"}];for(const{property:v,control:c}of r)(l=o.value)!=null&&l.closest(`[data-control="${c}"]`)&&(e.style[v]="");return}t.value.value=s.value,t.value.dispatchEvent(new Event("input")),t.value.focus()}function d(n,l){if(n.stopPropagation(),n.preventDefault(),!t.value){const e=o.value;h(l),m.value=performance.now(),setTimeout(()=>{const r=O();if(!r)return;const v=[{property:"color",control:"typography"},{property:"backgroundColor",control:"background"},{property:"borderColor",control:"border"}];for(const{property:c,control:y}of v)e!=null&&e.closest(`[data-control="${y}"]`)&&(r.style[c]="")},5);return}t.value.value=`var(${l})`,t.value.dispatchEvent(new Event("input")),t.value.focus(),s.value=`var(${l})`,m.value=performance.now()}function i(){document.querySelectorAll(".windpressbricks-variable-app-colorpopup").forEach(n=>{n.remove()})}function u(){if(document.querySelector(".windpressbricks-variable-app-colorpopup"))return;const n=".bricks-control-popup { display: none !important; }",l=document.createElement("style");l.id="windpressbricks-variable-app-bricks-popup",l.appendChild(document.createTextNode(n)),l.classList.add("windpressbricks-variable-app-colorpopup"),document.head.appendChild(l)}async function h(n){var e,r,v,c,y;u(),document.querySelector(".bricks-control-popup .color-palette.grid")||((r=(e=o.value)==null?void 0:e.closest(".bricks-control-preview"))==null||r.click(),await new Promise(k=>setTimeout(k,25)));const l=document.querySelector(".bricks-control-popup .color-palette.grid");l?(c=(v=l.querySelector(`[data-balloon="var(${n})"]`))==null?void 0:v.parentElement)==null||c.click():q("Failed to select color. Color grid not found.",{module:"variable-picker",type:"error"}),(y=document.querySelector("body"))==null||y.click(),await new Promise(k=>setTimeout(k,2)),document.querySelector(".bricks-control-popup")?(setTimeout(()=>{var k;(k=document.querySelector("body"))==null||k.click(),setTimeout(()=>{i()},5)},5),q("Failed to close color picker. Delaying close.",{module:"variable-picker",type:"error"})):i()}return(n,l)=>{const e=W("tooltip");return b(),f("div",ye,[(b(!0),f(D,null,F(a.variableItems,(r,v)=>(b(),f("div",{key:v,class:""},[w("div",ge,N(v),1),r.DEFAULT?(b(),f("div",he,[T(w("button",{onClick:c=>d(c,r.DEFAULT.key),onMouseenter:c=>p(c,r.DEFAULT.key),onMouseleave:g,class:S([`bg:$(${r.DEFAULT.key.slice(2)})`,"w:full r:4 h:24 border:1|solid|transparent border:white:hover"])},null,42,ke),[[e,{placement:"top",content:`var(${r.DEFAULT.key}, ${r.DEFAULT.value})`}]])])):z("",!0),r.shades&&Object.keys(r.shades).length>0?(b(),f("div",{key:1,class:S([[{},`grid-template-cols:repeat(${Object.keys(r.shades).length},auto)`],"variable-section-items grid r:4 overflow:hidden"])},[(b(!0),f(D,null,F(r.shades,(c,y)=>(b(),f("div",{key:y,class:"flex gap:10"},[T(w("button",{onClick:k=>d(k,c.key),onMouseenter:k=>p(k,c.key),onMouseleave:g,class:S([`bg:$(${c.key.slice(2)})`,"w:full h:24 border:1|solid|transparent border:white:hover"])},null,42,we),[[e,{placement:"top",content:`var(${c.key}, ${c.value})`}]])]))),128))],2)):z("",!0)]))),128))])}}},j=a=>(Ge("data-v-d9172fa2"),a=a(),Je(),a),Ee={id:"windpressbricks-variable-app-body",class:"rel w:full h:full overflow-y:scroll!"},Ce=j(()=>w("span",{class:"font:semibold"},"Color",-1)),xe=j(()=>w("span",{class:"font:semibold"},"Typography",-1)),Ie=j(()=>w("span",{class:"font:semibold"},"Sizing",-1)),Te={__name:"PanelBody",setup(a){const t=E({colors:{},typography:{},sizing:{}}),o=_("focusedInput"),m=_("recentColorPickerTarget");async function s(){const i=await Xe.contentWindow.wp.hooks.applyFilters("windpress.module.design_system.main_css"),u=at(tt(i)),h={};u.filter(e=>e.key.startsWith("--color")).forEach(e=>{const r=e.key.slice(8),v=r.split("-");let c="";if(v.length>1){const y=v[0],k=v.slice(1).join("-");c=`${y}.shades.'${k}'`}else c=`${r}.DEFAULT`;nt(h,c,e)}),t.value.colors=Object.keys(h).sort().reduce((e,r)=>(e[r]=h[r],e),{});const n={font_size:[],line_height:[],letter_spacing:[]};u.filter(e=>e.key.startsWith("--font-size-")&&!e.key.endsWith("--line-height")).forEach(e=>{const r=e.key.slice(12);n.font_size.push({key:e.key,label:r,value:e.value})}),u.filter(e=>e.key.startsWith("--line-height-")||e.key.endsWith("--line-height")).forEach(e=>{const r=e.key.startsWith("--line-height-")?e.key.slice(14):e.key.slice(2,-13);n.line_height.push({key:e.key,label:r,value:e.value})}),n.line_height.sort((e,r)=>e.label.startsWith("font-size-")&&!r.label.startsWith("font-size-")?1:!e.label.startsWith("font-size-")&&r.label.startsWith("font-size-")?-1:0),u.filter(e=>e.key.startsWith("--letter-spacing-")).forEach(e=>{const r=e.key.slice(17);n.letter_spacing.push({key:e.key,label:r,value:e.value})}),t.value.typography=n;const l={spacing:[],width:[],breakpoint:[]};u.filter(e=>e.key.startsWith("--spacing-")).forEach(e=>{const r=e.key.slice(10);l.spacing.push({key:e.key,label:r,value:e.value})}),u.filter(e=>e.key.startsWith("--width-")).forEach(e=>{const r=e.key.slice(8);l.width.push({key:e.key,label:r,value:e.value})}),u.filter(e=>e.key.startsWith("--breakpoint-")).forEach(e=>{const r=e.key.slice(13);l.breakpoint.push({key:e.key,label:r,value:e.value})}),t.value.sizing=l}const p=E(null),g=E(null),d=E(null);return V(o,i=>{var u,h,n,l;if(i){const e=((h=(u=i.closest("[data-controlkey]"))==null?void 0:u.dataset.controlkey)==null?void 0:h.toLocaleLowerCase())??"",r=["typography","font"].some(y=>e.includes(y)),v=["padding","margin","gap","width","height"].some(y=>e.includes(y)),c=(l=(n=i.parentElement)==null?void 0:n.parentElement)==null?void 0:l.classList.contains("color-input");["_gridTemplateColumns","_gridTemplateRows"].some(y=>e.includes(y.toLocaleLowerCase())),g.value.togglePanel(!1),d.value.togglePanel(!1),p.value.togglePanel(!1),c?(p.value.togglePanel(!0),p.value.scrollIntoView()):r?(g.value.togglePanel(!0),g.value.scrollIntoView()):v&&(d.value.togglePanel(!0),d.value.scrollIntoView())}}),V(m,i=>{i&&(p.value.togglePanel(!0),p.value.scrollIntoView())}),ee(()=>{s()}),new BroadcastChannel("windpress").addEventListener("message",async i=>{const u=i.data;u.source==="windpress/autocomplete"&&u.task==="windpress.main_css.saved.done"&&setTimeout(()=>{s()},1e3)}),(i,u)=>(b(),f("div",Ee,[$(M,{namespace:"variable",name:"color",ref_key:"sectionColor",ref:p},{header:I(()=>[Ce]),default:I(()=>[$($e,{variableItems:t.value.colors},null,8,["variableItems"])]),_:1},512),$(M,{namespace:"variable",name:"typography",ref_key:"sectionTypography",ref:g},{header:I(()=>[xe]),default:I(()=>[$(X,{variableItems:t.value.typography},null,8,["variableItems"])]),_:1},512),$(M,{namespace:"variable",name:"spacing",ref_key:"sectionSpacing",ref:d,class:""},{header:I(()=>[Ie]),default:I(()=>[$(X,{variableItems:t.value.sizing},null,8,["variableItems"])]),_:1},512)]))}},Pe=U(Te,[["__scopeId","data-v-d9172fa2"]]),Se={id:"windpressbricks-variable-app-container",class:"flex flex:column w:full h:full fg:$(builder-color) bg:$(builder-bg) r:10 overflow:hidden box-shadow:$(builder-box-shadow) outline:1|solid|$(builder-color-accent)"},Le={__name:"App",setup(a){const t=_("isOpen");return(o,m)=>{const s=W("resizable");return T((b(),f("div",Se,[$(ne),(b(),Qe(Ze,null,{default:I(()=>[$(Pe)]),_:1}))])),[[je,x(t)],[s,{minWidth:300,minHeight:500},void 0,{br:!0}]])}}},Ae=U(Le,[["__scopeId","data-v-1d394937"]]),L=document.createElement("windpressbricks-variable-app");L.id="windpressbricks-variable-app",document.body.appendChild(L);const P=E(!1),A=E(null),Y=E(null),R=E(null),qe=E(0),C=Re(Ae);C.config.globalProperties.windpressbricks=window.windpressbricks,C.provide("variableApp",L),C.provide("isOpen",P),C.provide("focusedInput",A),C.provide("tempInputValue",Y),C.provide("recentColorPickerTarget",R),C.provide("recentVariableSelectionTimestamp",qe),C.use(Be,{container:"#windpressbricks-variable-app"}).use(Ne),C.component("font-awesome-icon",Ue).component("inline-svg",He),C.mount("#windpressbricks-variable-app");function G(a){var t;!a.shiftKey||!a.target||((t=document==null?void 0:document.getSelection())==null||t.removeAllRanges(),a.preventDefault(),a.stopPropagation(),A.value=a.target,Y.value=a.target.value,P.value=!0)}function J(a){A.value=a.target}const We={includedFields:['div[data-control="number"]',{selector:'div[data-control="text"]',hasChild:["#_cssTransition","#_transformOrigin","#_flexBasis","#_overflow","#_gridTemplateColumns","#_gridTemplateRows","#_gridAutoColumns","#_gridAutoRows","#_objectPosition",'[id^="raw-"]']}],excludedFields:[".control-query",'div[data-controlkey="start"]','div[data-controlkey="perPage"]','div[data-controlkey="perMove"]','div[data-controlkey="speed"]']};function Q(){setTimeout(()=>{We.includedFields.forEach(a=>{(typeof a=="string"?[...document.querySelectorAll(a)]:[...document.querySelectorAll(a.selector)].filter(t=>a.hasChild.some(o=>t.querySelector(o)))).forEach(t=>{const o=t.querySelector("input[type='text']");(o==null?void 0:o.getAttribute("windpressbricks-variable-app"))!=="true"&&(o==null||o.removeEventListener("click",G),o==null||o.addEventListener("click",G),o==null||o.removeEventListener("focus",J),o==null||o.addEventListener("focus",J),o==null||o.setAttribute("windpressbricks-variable-app","true"),o==null||o.parentNode.setAttribute("data-balloon","Shift + click to open the Variable Picker"),o==null||o.parentNode.setAttribute("data-balloon-pos","bottom-right"))})}),[...document.querySelectorAll(".bricks-control-preview")].filter(a=>{var t,o;return((o=(t=a.closest(".control-inner"))==null?void 0:t.querySelector("label"))==null?void 0:o.getAttribute("for"))==="color"}).forEach(a=>{const t=a.querySelector(".color-value-tooltip");t&&t.setAttribute("data-balloon",t.getAttribute("data-balloon")||"Shift + right click to open the Variable Picker"),a.addEventListener("contextmenu",o=>{var m;!o.shiftKey||!o.target||(o.preventDefault(),o.stopPropagation(),(m=document==null?void 0:document.getSelection())==null||m.removeAllRanges(),A.value=null,P.value=!0,R.value=null,et(()=>{R.value=o.target}))})})},100)}let B=!1;fe({selector:"#bricks-panel-inner",options:{subtree:!0,childList:!0},callback(){B||(B=!0,Q(),setTimeout(()=>{B=!1},100))}}),Q(),document.addEventListener("keydown",a=>{a.key==="Escape"&&P.value&&(P.value=!1)}),V(P,a=>{L.style.zIndex=a?"calc(Infinity)":"-1"}),q("Module loaded!",{module:"variable-picker"})});
