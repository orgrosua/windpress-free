var C=new Map;function R(s){var t=C.get(s);t&&t.destroy()}function D(s){var t=C.get(s);t&&t.update()}var S=null;typeof window>"u"?((S=function(s){return s}).destroy=function(s){return s},S.update=function(s){return s}):((S=function(s,t){return s&&Array.prototype.forEach.call(s.length?s:[s],function(n){return function(e){if(e&&e.nodeName&&e.nodeName==="TEXTAREA"&&!C.has(e)){var i,r=null,o=window.getComputedStyle(e),l=(i=e.value,function(){u({testForHeightReduction:i===""||!e.value.startsWith(i),restoreTextAlign:null}),i=e.value}),a=(function(d){e.removeEventListener("autosize:destroy",a),e.removeEventListener("autosize:update",c),e.removeEventListener("input",l),window.removeEventListener("resize",c),Object.keys(d).forEach(function(h){return e.style[h]=d[h]}),C.delete(e)}).bind(e,{height:e.style.height,resize:e.style.resize,textAlign:e.style.textAlign,overflowY:e.style.overflowY,overflowX:e.style.overflowX,wordWrap:e.style.wordWrap});e.addEventListener("autosize:destroy",a),e.addEventListener("autosize:update",c),e.addEventListener("input",l),window.addEventListener("resize",c),e.style.overflowX="hidden",e.style.wordWrap="break-word",C.set(e,{destroy:a,update:c}),c()}function u(d){var h,g,m=d.restoreTextAlign,f=m===void 0?null:m,b=d.testForHeightReduction,y=b===void 0||b,A=o.overflowY;if(e.scrollHeight!==0&&(o.resize==="vertical"?e.style.resize="none":o.resize==="both"&&(e.style.resize="horizontal"),y&&(h=function(v){for(var L=[];v&&v.parentNode&&v.parentNode instanceof Element;)v.parentNode.scrollTop&&L.push([v.parentNode,v.parentNode.scrollTop]),v=v.parentNode;return function(){return L.forEach(function(x){var T=x[0],k=x[1];T.style.scrollBehavior="auto",T.scrollTop=k,T.style.scrollBehavior=null})}}(e),e.style.height=""),g=o.boxSizing==="content-box"?e.scrollHeight-(parseFloat(o.paddingTop)+parseFloat(o.paddingBottom)):e.scrollHeight+parseFloat(o.borderTopWidth)+parseFloat(o.borderBottomWidth),o.maxHeight!=="none"&&g>parseFloat(o.maxHeight)?(o.overflowY==="hidden"&&(e.style.overflow="scroll"),g=parseFloat(o.maxHeight)):o.overflowY!=="hidden"&&(e.style.overflow="hidden"),e.style.height=g+"px",f&&(e.style.textAlign=f),h&&h(),r!==g&&(e.dispatchEvent(new Event("autosize:resized",{bubbles:!0})),r=g),A!==o.overflow&&!f)){var M=o.textAlign;o.overflow==="hidden"&&(e.style.textAlign=M==="start"?"end":"start"),u({restoreTextAlign:M,testForHeightReduction:!0})}}function c(){u({testForHeightReduction:!0,restoreTextAlign:null})}}(n)}),s}).destroy=function(s){return s&&Array.prototype.forEach.call(s.length?s:[s],R),s},S.update=function(s){return s&&Array.prototype.forEach.call(s.length?s:[s],D),s});var P=S;if(Array.prototype.find||(Array.prototype.find=function(s){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof s!="function")throw new TypeError("predicate must be a function");for(var t=Object(this),n=t.length>>>0,e=arguments[1],i,r=0;r<n;r++)if(i=t[r],s.call(e,i,r,t))return i}),window&&typeof window.CustomEvent!="function"){let s=function(t,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var e=document.createEvent("CustomEvent");return e.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),e};typeof window.Event<"u"&&(s.prototype=window.Event.prototype),window.CustomEvent=s}class N{constructor(t){this.tribute=t,this.tribute.events=this}static keys(){return[{key:9,value:"TAB"},{key:8,value:"DELETE"},{key:13,value:"ENTER"},{key:27,value:"ESCAPE"},{key:32,value:"SPACE"},{key:38,value:"UP"},{key:40,value:"DOWN"}]}bind(t){t.boundKeydown=this.keydown.bind(t,this),t.boundKeyup=this.keyup.bind(t,this),t.boundInput=this.input.bind(t,this),t.addEventListener("keydown",t.boundKeydown,!1),t.addEventListener("keyup",t.boundKeyup,!1),t.addEventListener("input",t.boundInput,!1)}unbind(t){t.removeEventListener("keydown",t.boundKeydown,!1),t.removeEventListener("keyup",t.boundKeyup,!1),t.removeEventListener("input",t.boundInput,!1),delete t.boundKeydown,delete t.boundKeyup,delete t.boundInput}keydown(t,n){t.shouldDeactivate(n)&&(t.tribute.isActive=!1,t.tribute.hideMenu());let e=this;t.commandEvent=!1,N.keys().forEach(i=>{i.key===n.keyCode&&(t.commandEvent=!0,t.callbacks()[i.value.toLowerCase()](n,e))})}input(t,n){t.inputEvent=!0,t.keyup.call(this,t,n)}click(t,n){let e=t.tribute;if(e.menu&&e.menu.contains(n.target)){let i=n.target;for(n.preventDefault(),n.stopPropagation();i.nodeName.toLowerCase()!=="li";)if(i=i.parentNode,!i||i===e.menu)throw new Error("cannot find the <li> container for the click");e.selectItemAtIndex(i.getAttribute("data-index"),n),e.hideMenu()}else e.current.element&&!e.current.externalTrigger&&(e.current.externalTrigger=!1,setTimeout(()=>e.hideMenu()))}keyup(t,n){if(t.inputEvent&&(t.inputEvent=!1),t.updateSelection(this),n.keyCode!==27){if(!t.tribute.allowSpaces&&t.tribute.hasTrailingSpace){t.tribute.hasTrailingSpace=!1,t.commandEvent=!0,t.callbacks().space(n,this);return}if(!t.tribute.isActive)if(t.tribute.autocompleteMode)t.callbacks().triggerChar(n,this,"");else{let e=t.getKeyCode(t,this,n);if(isNaN(e)||!e)return;let i=t.tribute.triggers().find(r=>r.charCodeAt(0)===e);typeof i<"u"&&t.callbacks().triggerChar(n,this,i)}t.tribute.current.mentionText.length<t.tribute.current.collection.menuShowMinLength||((t.tribute.current.trigger||t.tribute.autocompleteMode)&&t.commandEvent===!1||t.tribute.isActive&&n.keyCode===8)&&t.tribute.showMenuFor(this,!0)}}shouldDeactivate(t){if(!this.tribute.isActive)return!1;if(this.tribute.current.mentionText.length===0){let n=!1;return N.keys().forEach(e=>{t.keyCode===e.key&&(n=!0)}),!n}return!1}getKeyCode(t,n,e){let i=t.tribute,r=i.range.getTriggerInfo(!1,i.hasTrailingSpace,!0,i.allowSpaces,i.autocompleteMode);return r?r.mentionTriggerChar.charCodeAt(0):!1}updateSelection(t){this.tribute.current.element=t;let n=this.tribute.range.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces,this.tribute.autocompleteMode);n&&(this.tribute.current.selectedPath=n.mentionSelectedPath,this.tribute.current.mentionText=n.mentionText,this.tribute.current.selectedOffset=n.mentionSelectedOffset)}callbacks(){return{triggerChar:(t,n,e)=>{let i=this.tribute;i.current.trigger=e;let r=i.collection.find(o=>o.trigger===e);i.current.collection=r,i.current.mentionText.length>=i.current.collection.menuShowMinLength&&i.inputEvent&&i.showMenuFor(n,!0)},enter:(t,n)=>{this.tribute.isActive&&this.tribute.current.filteredItems&&(t.preventDefault(),t.stopPropagation(),setTimeout(()=>{this.tribute.selectItemAtIndex(this.tribute.menuSelected,t),this.tribute.hideMenu()},0))},escape:(t,n)=>{this.tribute.isActive&&(t.preventDefault(),t.stopPropagation(),this.tribute.isActive=!1,this.tribute.hideMenu())},tab:(t,n)=>{this.callbacks().enter(t,n)},space:(t,n)=>{this.tribute.isActive&&(this.tribute.spaceSelectsMatch?this.callbacks().enter(t,n):this.tribute.allowSpaces||(t.stopPropagation(),setTimeout(()=>{this.tribute.hideMenu(),this.tribute.isActive=!1},0)))},up:(t,n)=>{if(this.tribute.isActive&&this.tribute.current.filteredItems){t.preventDefault(),t.stopPropagation();let e=this.tribute.current.filteredItems.length,i=this.tribute.menuSelected;e>i&&i>0?(this.tribute.menuSelected--,this.setActiveLi()):i===0&&(this.tribute.menuSelected=e-1,this.setActiveLi(),this.tribute.menu.scrollTop=this.tribute.menu.scrollHeight)}},down:(t,n)=>{if(this.tribute.isActive&&this.tribute.current.filteredItems){t.preventDefault(),t.stopPropagation();let e=this.tribute.current.filteredItems.length-1,i=this.tribute.menuSelected;e>i?(this.tribute.menuSelected++,this.setActiveLi()):e===i&&(this.tribute.menuSelected=0,this.setActiveLi(),this.tribute.menu.scrollTop=0)}},delete:(t,n)=>{this.tribute.isActive&&this.tribute.current.mentionText.length<1?this.tribute.hideMenu():this.tribute.isActive&&this.tribute.showMenuFor(n)}}}setActiveLi(t){let n=this.tribute.menu.querySelectorAll("li"),e=n.length>>>0;t&&(this.tribute.menuSelected=parseInt(t));for(let i=0;i<e;i++){let r=n[i];if(i===this.tribute.menuSelected){r.classList.add(this.tribute.current.collection.selectClass);let o=r.getBoundingClientRect(),l=this.tribute.menu.getBoundingClientRect();if(o.bottom>l.bottom){let a=o.bottom-l.bottom;this.tribute.menu.scrollTop+=a}else if(o.top<l.top){let a=l.top-o.top;this.tribute.menu.scrollTop-=a}}else r.classList.remove(this.tribute.current.collection.selectClass)}}getFullHeight(t,n){let e=t.getBoundingClientRect().height;if(n){let i=t.currentStyle||window.getComputedStyle(t);return e+parseFloat(i.marginTop)+parseFloat(i.marginBottom)}return e}}class H{constructor(t){this.tribute=t,this.tribute.menuEvents=this,this.menu=this.tribute.menu}bind(t){this.menuClickEvent=this.tribute.events.click.bind(null,this),this.menuContainerScrollEvent=this.debounce(()=>{this.tribute.isActive&&this.tribute.hideMenu()},10,!1),this.windowResizeEvent=this.debounce(()=>{this.tribute.isActive&&this.tribute.hideMenu()},10,!1),this.tribute.range.getDocument().addEventListener("MSPointerDown",this.menuClickEvent,!1),this.tribute.range.getDocument().addEventListener("mousedown",this.menuClickEvent,!1),window.addEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.addEventListener("scroll",this.menuContainerScrollEvent,!1):window.addEventListener("scroll",this.menuContainerScrollEvent)}unbind(t){this.tribute.range.getDocument().removeEventListener("mousedown",this.menuClickEvent,!1),this.tribute.range.getDocument().removeEventListener("MSPointerDown",this.menuClickEvent,!1),window.removeEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.removeEventListener("scroll",this.menuContainerScrollEvent,!1):window.removeEventListener("scroll",this.menuContainerScrollEvent)}debounce(t,n,e){var i;return()=>{var r=this,o=arguments,l=()=>{i=null,e||t.apply(r,o)},a=e&&!i;clearTimeout(i),i=setTimeout(l,n),a&&t.apply(r,o)}}}class O{constructor(t){this.tribute=t,this.tribute.range=this}getDocument(){let t;return this.tribute.current.collection&&(t=this.tribute.current.collection.iframe),t?t.contentWindow.document:document}positionMenuAtCaret(t){let n=this.tribute.current,e,i=this.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces,this.tribute.autocompleteMode);if(typeof i<"u"){if(!this.tribute.positionMenu){this.tribute.menu.style.cssText="display: block;";return}this.isContentEditable(n.element)?e=this.getContentEditableCaretPosition(i.mentionPosition):e=this.getTextAreaOrInputUnderlinePosition(this.tribute.current.element,i.mentionPosition),this.tribute.menu.style.cssText=`top: ${e.top}px;
                                     left: ${e.left}px;
                                     right: ${e.right}px;
                                     bottom: ${e.bottom}px;
                                     max-height: ${e.maxHeight||500}px;
                                     max-width: ${e.maxWidth||300}px;
                                     position: ${e.position||"absolute"};
                                     display: block;`,e.left==="auto"&&(this.tribute.menu.style.left="auto"),e.top==="auto"&&(this.tribute.menu.style.top="auto"),t&&this.scrollIntoView()}else this.tribute.menu.style.cssText="display: none"}get menuContainerIsBody(){return this.tribute.menuContainer===document.body||!this.tribute.menuContainer}selectElement(t,n,e){let i,r=t;if(n)for(var o=0;o<n.length;o++){if(r=r.childNodes[n[o]],r===void 0)return;for(;r.length<e;)e-=r.length,r=r.nextSibling;r.childNodes.length===0&&!r.length&&(r=r.previousSibling)}let l=this.getWindowSelection();i=this.getDocument().createRange(),i.setStart(r,e),i.setEnd(r,e),i.collapse(!0);try{l.removeAllRanges()}catch{}l.addRange(i),t.focus()}replaceTriggerText(t,n,e,i,r){let o=this.getTriggerInfo(!0,e,n,this.tribute.allowSpaces,this.tribute.autocompleteMode);if(o!==void 0){let l=this.tribute.current,a=new CustomEvent("tribute-replaced",{detail:{item:r,instance:l,context:o,event:i}});if(this.isContentEditable(l.element)){let u=typeof this.tribute.replaceTextSuffix=="string"?this.tribute.replaceTextSuffix:"\xA0";t+=u;let c=o.mentionPosition+o.mentionText.length;this.tribute.autocompleteMode||(c+=o.mentionTriggerChar.length),this.pasteHtml(t,o.mentionPosition,c)}else{let u=this.tribute.current.element,c=typeof this.tribute.replaceTextSuffix=="string"?this.tribute.replaceTextSuffix:" ";t+=c;let d=o.mentionPosition,h=o.mentionPosition+o.mentionText.length+c.length;this.tribute.autocompleteMode||(h+=o.mentionTriggerChar.length-1),u.value=u.value.substring(0,d)+t+u.value.substring(h,u.value.length),u.selectionStart=d+t.length,u.selectionEnd=d+t.length}l.element.dispatchEvent(new CustomEvent("input",{bubbles:!0})),l.element.dispatchEvent(a)}}pasteHtml(t,n,e){let i,r;r=this.getWindowSelection(),i=this.getDocument().createRange(),i.setStart(r.anchorNode,n),i.setEnd(r.anchorNode,e),i.deleteContents();let o=this.getDocument().createElement("div");o.innerHTML=t;let l=this.getDocument().createDocumentFragment(),a,u;for(;a=o.firstChild;)u=l.appendChild(a);i.insertNode(l),u&&(i=i.cloneRange(),i.setStartAfter(u),i.collapse(!0),r.removeAllRanges(),r.addRange(i))}getWindowSelection(){return this.tribute.collection.iframe?this.tribute.collection.iframe.contentWindow.getSelection():window.getSelection()}getNodePositionInParent(t){if(t.parentNode===null)return 0;for(var n=0;n<t.parentNode.childNodes.length;n++)if(t.parentNode.childNodes[n]===t)return n}getContentEditableSelectedPath(t){let n=this.getWindowSelection(),e=n.anchorNode,i=[],r;if(e!=null){let o,l=e.contentEditable;for(;e!==null&&l!=="true";)o=this.getNodePositionInParent(e),i.push(o),e=e.parentNode,e!==null&&(l=e.contentEditable);return i.reverse(),r=n.getRangeAt(0).startOffset,{selected:e,path:i,offset:r}}}getTextPrecedingCurrentSelection(){let t=this.tribute.current,n="";if(this.isContentEditable(t.element)){let e=this.getWindowSelection().anchorNode;if(e!=null){let i=e.textContent,r=this.getWindowSelection().getRangeAt(0).startOffset;i&&r>=0&&(n=i.substring(0,r))}}else{let e=this.tribute.current.element;if(e){let i=e.selectionStart;e.value&&i>=0&&(n=e.value.substring(0,i))}}return n}getLastWordInText(t){t=t.replace(/\u00A0/g," ");var n;this.tribute.autocompleteSeparator?n=t.split(this.tribute.autocompleteSeparator):n=t.split(/\s+/);var e=n.length-1;return n[e].trim()}getTriggerInfo(t,n,e,i,r){let o=this.tribute.current,l,a,u;if(!this.isContentEditable(o.element))l=this.tribute.current.element;else{let h=this.getContentEditableSelectedPath(o);h&&(l=h.selected,a=h.path,u=h.offset)}let c=this.getTextPrecedingCurrentSelection(),d=this.getLastWordInText(c);if(r)return{mentionPosition:c.length-d.length,mentionText:d,mentionSelectedElement:l,mentionSelectedPath:a,mentionSelectedOffset:u};if(c!=null){let h=-1,g;if(this.tribute.collection.forEach(m=>{let f=m.trigger,b=m.requireLeadingSpace?this.lastIndexWithLeadingSpace(c,f):c.lastIndexOf(f);b>h&&(h=b,g=f,e=m.requireLeadingSpace)}),h>=0&&(h===0||!e||/[\xA0\s]/g.test(c.substring(h-1,h)))){let m=c.substring(h+g.length,c.length);g=c.substring(h,h+g.length);let f=m.substring(0,1),b=m.length>0&&(f===" "||f==="\xA0");n&&(m=m.trim());let y=i?/[^\S ]/g:/[\xA0\s]/g;if(this.tribute.hasTrailingSpace=y.test(m),!b&&(t||!y.test(m)))return{mentionPosition:h,mentionText:m,mentionSelectedElement:l,mentionSelectedPath:a,mentionSelectedOffset:u,mentionTriggerChar:g}}}}lastIndexWithLeadingSpace(t,n){let e=t.split("").reverse().join(""),i=-1;for(let r=0,o=t.length;r<o;r++){let l=r===t.length-1,a=/\s/.test(e[r+1]),u=!0;for(let c=n.length-1;c>=0;c--)if(n[c]!==e[r-c]){u=!1;break}if(u&&(l||a)){i=t.length-1-r;break}}return i}isContentEditable(t){return t.nodeName!=="INPUT"&&t.nodeName!=="TEXTAREA"}isMenuOffScreen(t,n){let e=window.innerWidth,i=window.innerHeight,r=document.documentElement,o=(window.pageXOffset||r.scrollLeft)-(r.clientLeft||0),l=(window.pageYOffset||r.scrollTop)-(r.clientTop||0),a=typeof t.top=="number"?t.top:l+i-t.bottom-n.height,u=typeof t.right=="number"?t.right:t.left+n.width,c=typeof t.bottom=="number"?t.bottom:t.top+n.height,d=typeof t.left=="number"?t.left:o+e-t.right-n.width;return{top:a<Math.floor(l),right:u>Math.ceil(o+e),bottom:c>Math.ceil(l+i),left:d<Math.floor(o)}}getMenuDimensions(){let t={width:null,height:null};return this.tribute.menu.style.cssText=`top: 0px;
                                 left: 0px;
                                 position: fixed;
                                 display: block;
                                 visibility; hidden;
                                 max-height:500px;`,t.width=this.tribute.menu.offsetWidth,t.height=this.tribute.menu.offsetHeight,this.tribute.menu.style.cssText="display: none;",t}getTextAreaOrInputUnderlinePosition(t,n,e){let i=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"],r=this.getDocument().createElement("div");r.id="input-textarea-caret-position-mirror-div",this.getDocument().body.appendChild(r);let o=r.style,l=window.getComputedStyle?getComputedStyle(t):t.currentStyle;o.whiteSpace="pre-wrap",t.nodeName!=="INPUT"&&(o.wordWrap="break-word"),o.position="absolute",o.visibility="hidden",i.forEach(g=>{o[g]=l[g]});let a=document.createElement("span");a.textContent=t.value.substring(0,n),r.appendChild(a),t.nodeName==="INPUT"&&(r.textContent=r.textContent.replace(/\s/g,"\xA0"));let u=this.getDocument().createElement("span");u.textContent="&#x200B;",r.appendChild(u);let c=this.getDocument().createElement("span");c.textContent=t.value.substring(n),r.appendChild(c);let d=t.getBoundingClientRect();r.style.position="fixed",r.style.left=d.left+"px",r.style.top=d.top+"px",r.style.width=d.width+"px",r.style.height=d.height+"px",r.scrollTop=t.scrollTop;var h=u.getBoundingClientRect();return this.getDocument().body.removeChild(r),this.getFixedCoordinatesRelativeToRect(h)}getContentEditableCaretPosition(t){let n,e=this.getWindowSelection();n=this.getDocument().createRange(),n.setStart(e.anchorNode,t),n.setEnd(e.anchorNode,t),n.collapse(!1);let i=n.getBoundingClientRect();return this.getFixedCoordinatesRelativeToRect(i)}getFixedCoordinatesRelativeToRect(t){let n={position:"fixed",left:t.left,top:t.top+t.height},e=this.getMenuDimensions();var i=t.top,r=window.innerHeight-(t.top+t.height);r<e.height&&(i>=e.height||i>r?(n.top="auto",n.bottom=window.innerHeight-t.top,r<e.height&&(n.maxHeight=i)):i<e.height&&(n.maxHeight=r));var o=t.left,l=window.innerWidth-t.left;return l<e.width&&(o>=e.width||o>l?(n.left="auto",n.right=window.innerWidth-t.left,l<e.width&&(n.maxWidth=o)):o<e.width&&(n.maxWidth=l)),n}scrollIntoView(t){let n=20,e,i=100,r=this.menu;if(typeof r>"u")return;for(;e===void 0||e.height===0;)if(e=r.getBoundingClientRect(),e.height===0&&(r=r.childNodes[0],r===void 0||!r.getBoundingClientRect))return;let o=e.top,l=o+e.height;if(o<0)window.scrollTo(0,window.pageYOffset+e.top-n);else if(l>window.innerHeight){let a=window.pageYOffset+e.top-n;a-window.pageYOffset>i&&(a=window.pageYOffset+i);let u=window.pageYOffset-(window.innerHeight-l);u>a&&(u=a),window.scrollTo(0,u)}}}class W{constructor(t){this.tribute=t,this.tribute.search=this}simpleFilter(t,n){return n.filter(e=>this.test(t,e))}test(t,n){return this.match(t,n)!==null}match(t,n,e){e=e||{},n.length;let i=e.pre||"",r=e.post||"",o=e.caseSensitive&&n||n.toLowerCase();if(e.skip)return{rendered:n,score:0};t=e.caseSensitive&&t||t.toLowerCase();let l=this.traverse(o,t,0,0,[]);return l?{rendered:this.render(n,l.cache,i,r),score:l.score}:null}traverse(t,n,e,i,r){if(this.tribute.autocompleteSeparator&&(n=n.split(this.tribute.autocompleteSeparator).splice(-1)[0]),n.length===i)return{score:this.calculateScore(r),cache:r.slice()};if(t.length===e||n.length-i>t.length-e)return;let o=n[i],l=t.indexOf(o,e),a,u;for(;l>-1;){if(r.push(l),u=this.traverse(t,n,l+1,i+1,r),r.pop(),!u)return a;(!a||a.score<u.score)&&(a=u),l=t.indexOf(o,l+1)}return a}calculateScore(t){let n=0,e=1;return t.forEach((i,r)=>{r>0&&(t[r-1]+1===i?e+=e+1:e=1),n+=e}),n}render(t,n,e,i){var r=t.substring(0,n[0]);return n.forEach((o,l)=>{r+=e+t[o]+i+t.substring(o+1,n[l+1]?n[l+1]:t.length)}),r}filter(t,n,e){return e=e||{},n.reduce((i,r,o,l)=>{let a=r;e.extract&&(a=e.extract(r),a||(a=""));let u=this.match(t,a,e);return u!=null&&(i[i.length]={string:u.rendered,score:u.score,index:o,original:r}),i},[]).sort((i,r)=>r.score-i.score||i.index-r.index)}}class w{constructor({values:t=null,loadingItemTemplate:n=null,iframe:e=null,selectClass:i="highlight",containerClass:r="tribute-container",itemClass:o="",trigger:l="@",autocompleteMode:a=!1,autocompleteSeparator:u=null,selectTemplate:c=null,menuItemTemplate:d=null,lookup:h="key",fillAttr:g="value",collection:m=null,menuContainer:f=null,noMatchTemplate:b=null,requireLeadingSpace:y=!0,allowSpaces:A=!1,replaceTextSuffix:M=null,positionMenu:v=!0,spaceSelectsMatch:L=!1,searchOpts:x={},menuItemLimit:T=null,menuShowMinLength:k=0}){if(this.autocompleteMode=a,this.autocompleteSeparator=u,this.menuSelected=0,this.current={},this.inputEvent=!1,this.isActive=!1,this.menuContainer=f,this.allowSpaces=A,this.replaceTextSuffix=M,this.positionMenu=v,this.hasTrailingSpace=!1,this.spaceSelectsMatch=L,this.autocompleteMode&&(l="",A=!1),t)this.collection=[{trigger:l,iframe:e,selectClass:i,containerClass:r,itemClass:o,selectTemplate:(c||w.defaultSelectTemplate).bind(this),menuItemTemplate:(d||w.defaultMenuItemTemplate).bind(this),noMatchTemplate:(p=>typeof p=="string"?p.trim()===""?null:p:typeof p=="function"?p.bind(this):b||(function(){return"<li>No Match Found!</li>"}).bind(this))(b),lookup:h,fillAttr:g,values:t,loadingItemTemplate:n,requireLeadingSpace:y,searchOpts:x,menuItemLimit:T,menuShowMinLength:k}];else if(m)this.autocompleteMode&&console.warn("Tribute in autocomplete mode does not work for collections"),this.collection=m.map(p=>({trigger:p.trigger||l,iframe:p.iframe||e,selectClass:p.selectClass||i,containerClass:p.containerClass||r,itemClass:p.itemClass||o,selectTemplate:(p.selectTemplate||w.defaultSelectTemplate).bind(this),menuItemTemplate:(p.menuItemTemplate||w.defaultMenuItemTemplate).bind(this),noMatchTemplate:(E=>typeof E=="string"?E.trim()===""?null:E:typeof E=="function"?E.bind(this):b||(function(){return"<li>No Match Found!</li>"}).bind(this))(b),lookup:p.lookup||h,fillAttr:p.fillAttr||g,values:p.values,loadingItemTemplate:p.loadingItemTemplate,requireLeadingSpace:p.requireLeadingSpace,searchOpts:p.searchOpts||x,menuItemLimit:p.menuItemLimit||T,menuShowMinLength:p.menuShowMinLength||k}));else throw new Error("[Tribute] No collection specified.");new O(this),new N(this),new H(this),new W(this)}get isActive(){return this._isActive}set isActive(t){if(this._isActive!=t&&(this._isActive=t,this.current.element)){let n=new CustomEvent(`tribute-active-${t}`);this.current.element.dispatchEvent(n)}}static defaultSelectTemplate(t){return typeof t>"u"?`${this.current.collection.trigger}${this.current.mentionText}`:this.range.isContentEditable(this.current.element)?'<span class="tribute-mention">'+(this.current.collection.trigger+t.original[this.current.collection.fillAttr])+"</span>":this.current.collection.trigger+t.original[this.current.collection.fillAttr]}static defaultMenuItemTemplate(t){return t.string}static inputTypes(){return["TEXTAREA","INPUT"]}triggers(){return this.collection.map(t=>t.trigger)}attach(t){if(!t)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if(typeof jQuery<"u"&&t instanceof jQuery&&(t=t.get()),t.constructor===NodeList||t.constructor===HTMLCollection||t.constructor===Array){let e=t.length;for(var n=0;n<e;++n)this._attach(t[n])}else this._attach(t)}_attach(t){t.hasAttribute("data-tribute")&&console.warn("Tribute was already bound to "+t.nodeName),this.ensureEditable(t),this.events.bind(t),t.setAttribute("data-tribute",!0)}ensureEditable(t){if(w.inputTypes().indexOf(t.nodeName)===-1)if(t.contentEditable)t.contentEditable=!0;else throw new Error("[Tribute] Cannot bind to "+t.nodeName)}createMenu(t){let n=this.range.getDocument().createElement("div"),e=this.range.getDocument().createElement("ul");return n.className=t,n.appendChild(e),this.menuContainer?this.menuContainer.appendChild(n):this.range.getDocument().body.appendChild(n)}showMenuFor(t,n){if(this.isActive&&this.current.element===t&&this.current.mentionText===this.currentMentionTextSnapshot)return;this.currentMentionTextSnapshot=this.current.mentionText,this.menu||(this.menu=this.createMenu(this.current.collection.containerClass),t.tributeMenu=this.menu,this.menuEvents.bind(this.menu)),this.isActive=!0,this.menuSelected=0,this.current.mentionText||(this.current.mentionText="");const e=i=>{if(!this.isActive)return;let r=this.search.filter(this.current.mentionText,i,{pre:this.current.collection.searchOpts.pre||"<span>",post:this.current.collection.searchOpts.post||"</span>",skip:this.current.collection.searchOpts.skip,extract:a=>{if(typeof this.current.collection.lookup=="string")return a[this.current.collection.lookup];if(typeof this.current.collection.lookup=="function")return this.current.collection.lookup(a,this.current.mentionText);throw new Error("Invalid lookup attribute, lookup must be string or function.")}});this.current.collection.menuItemLimit&&(r=r.slice(0,this.current.collection.menuItemLimit)),this.current.filteredItems=r;let o=this.menu.querySelector("ul");if(!r.length){let a=new CustomEvent("tribute-no-match",{detail:this.menu});this.current.element.dispatchEvent(a),typeof this.current.collection.noMatchTemplate=="function"&&!this.current.collection.noMatchTemplate()||!this.current.collection.noMatchTemplate?this.hideMenu():(typeof this.current.collection.noMatchTemplate=="function"?o.innerHTML=this.current.collection.noMatchTemplate():o.innerHTML=this.current.collection.noMatchTemplate,this.range.positionMenuAtCaret(n));return}o.innerHTML="";let l=this.range.getDocument().createDocumentFragment();r.forEach((a,u)=>{let c=this.range.getDocument().createElement("li");c.setAttribute("data-index",u),c.className=this.current.collection.itemClass,c.addEventListener("mousemove",d=>{let[h,g]=this._findLiTarget(d.target);d.movementY!==0&&this.events.setActiveLi(g)}),this.menuSelected===u&&c.classList.add(this.current.collection.selectClass),c.innerHTML=this.current.collection.menuItemTemplate(a),l.appendChild(c)}),o.appendChild(l),this.range.positionMenuAtCaret(n)};typeof this.current.collection.values=="function"?(this.current.collection.loadingItemTemplate&&(this.menu.querySelector("ul").innerHTML=this.current.collection.loadingItemTemplate,this.range.positionMenuAtCaret(n)),this.current.collection.values(this.current.mentionText,e)):e(this.current.collection.values)}_findLiTarget(t){if(!t)return[];const n=t.getAttribute("data-index");return n?[t,n]:this._findLiTarget(t.parentNode)}showMenuForCollection(t,n){t!==document.activeElement&&this.placeCaretAtEnd(t),this.current.collection=this.collection[n||0],this.current.externalTrigger=!0,this.current.element=t,t.isContentEditable?this.insertTextAtCursor(this.current.collection.trigger):this.insertAtCaret(t,this.current.collection.trigger),this.showMenuFor(t)}placeCaretAtEnd(t){if(t.focus(),typeof window.getSelection<"u"&&typeof document.createRange<"u"){var n=document.createRange();n.selectNodeContents(t),n.collapse(!1);var e=window.getSelection();e.removeAllRanges(),e.addRange(n)}else if(typeof document.body.createTextRange<"u"){var i=document.body.createTextRange();i.moveToElementText(t),i.collapse(!1),i.select()}}insertTextAtCursor(t){var n,e;n=window.getSelection(),e=n.getRangeAt(0),e.deleteContents();var i=document.createTextNode(t);e.insertNode(i),e.selectNodeContents(i),e.collapse(!1),n.removeAllRanges(),n.addRange(e)}insertAtCaret(t,n){var e=t.scrollTop,i=t.selectionStart,r=t.value.substring(0,i),o=t.value.substring(t.selectionEnd,t.value.length);t.value=r+n+o,i=i+n.length,t.selectionStart=i,t.selectionEnd=i,t.focus(),t.scrollTop=e}hideMenu(){this.menu&&(this.menu.style.cssText="display: none;",this.isActive=!1,this.menuSelected=0,this.current={})}selectItemAtIndex(t,n){if(t=parseInt(t),typeof t!="number"||isNaN(t))return;let e=this.current.filteredItems[t],i=this.current.collection.selectTemplate(e);i!==null&&this.replaceText(i,n,e)}replaceText(t,n,e){this.range.replaceTriggerText(t,!0,!0,n,e)}_append(t,n,e){if(typeof t.values=="function")throw new Error("Unable to append to values, as it is a function.");e?t.values=n:t.values=t.values.concat(n)}append(t,n,e){let i=parseInt(t);if(typeof i!="number")throw new Error("please provide an index for the collection to update.");let r=this.collection[i];this._append(r,n,e)}appendCurrent(t,n){if(this.isActive)this._append(this.current.collection,t,n);else throw new Error("No active state. Please use append instead and pass an index.")}detach(t){if(!t)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if(typeof jQuery<"u"&&t instanceof jQuery&&(t=t.get()),t.constructor===NodeList||t.constructor===HTMLCollection||t.constructor===Array){let e=t.length;for(var n=0;n<e;++n)this._detach(t[n])}else this._detach(t)}_detach(t){this.events.unbind(t),t.tributeMenu&&this.menuEvents.unbind(t.tributeMenu),setTimeout(()=>{t.removeAttribute("data-tribute"),this.isActive=!1,t.tributeMenu&&t.tributeMenu.remove()})}}function I(s,t){this.init(s,t)}I.instance=function(s,t){return new I(s,t)},I.prototype={ID:"hit",init:function(s,t){typeof s=="string"?this.el=document.querySelector(s):this.el=s,this.getType(t)==="custom"?(this.highlight=t,this.generate()):console.error("valid config object not provided")},getType:function(s){let t=typeof s;if(s){if(Array.isArray(s))return s.length===2&&typeof s[0]=="number"&&typeof s[1]=="number"?"range":"array";if(t==="object"){if(s instanceof RegExp)return"regexp";if(s.hasOwnProperty("highlight"))return"custom"}else if(t==="function"||t==="string")return t}else return"falsey";return"other"},generate:function(){this.el.classList.add(this.ID+"-input",this.ID+"-content"),this.el.addEventListener("input",this.handleInput.bind(this)),this.el.addEventListener("scroll",this.handleScroll.bind(this)),this.highlights=document.createElement("div"),this.highlights.classList.add(this.ID+"-highlights",this.ID+"-content"),this.backdrop=document.createElement("div"),this.backdrop.classList.add(this.ID+"-backdrop"),this.backdrop.append(this.highlights),this.container=document.createElement("div"),this.container.classList.add(this.ID+"-container"),this.el.parentNode.insertBefore(this.container,this.el.nextSibling),this.container.append(this.backdrop),this.container.append(this.el),this.container.addEventListener("scroll",this.blockContainerScroll.bind(this)),this.handleInput()},handleInput:function(){let s=this.el.value,t=this.getRanges(s,this.highlight),n=this.removeStaggeredRanges(t),e=this.getBoundaries(n);this.renderMarks(e)},getRanges:function(s,t){switch(this.getType(t)){case"array":return this.getArrayRanges(s,t);case"function":return this.getFunctionRanges(s,t);case"regexp":return this.getRegExpRanges(s,t);case"string":return this.getStringRanges(s,t);case"range":return this.getRangeRanges(s,t);case"custom":return this.getCustomRanges(s,t);default:if(t)console.error("unrecognized highlight type");else return[]}},getArrayRanges:function(s,t){let n=t.map(this.getRanges.bind(this,s));return Array.prototype.concat.apply([],n)},getFunctionRanges:function(s,t){return this.getRanges(s,t(s))},getRegExpRanges:function(s,t){let n=[],e;for(;e=t.exec(s),e!==null&&(n.push([e.index,e.index+e[0].length]),!!t.global););return n},getStringRanges:function(s,t){let n=[],e=s.toLowerCase(),i=t.toLowerCase(),r=0;for(;r=e.indexOf(i,r),r!==-1;)n.push([r,r+i.length]),r+=i.length;return n},getRangeRanges:function(s,t){return[t]},getCustomRanges:function(s,t){let n=this.getRanges(s,t.highlight);return t.className&&n.forEach(function(e){e.className?e.className=t.className+" "+e.className:e.className=t.className}),t.blank&&n.forEach(function(e){e.blank=t.blank}),n},removeStaggeredRanges:function(s){let t=[];return s.forEach(function(n){t.some(function(e){let i=n[0]>e[0]&&n[0]<e[1],r=n[1]>e[0]&&n[1]<e[1];return i!==r})||t.push(n)}),t},getBoundaries:function(s){let t=[];return s.forEach(function(n){t.push({type:"start",index:n[0],className:n.className,blank:n.blank}),t.push({type:"stop",index:n[1]})}),this.sortBoundaries(t),t},sortBoundaries:function(s){s.sort(function(t,n){return t.index!==n.index?n.index-t.index:t.type==="stop"&&n.type==="start"?1:t.type==="start"&&n.type==="stop"?-1:0})},renderMarks:function(s){let t=this.el.value;const n=t;s.forEach(function(e,i){let r;e.type==="start"?r="{{hit-mark-start|"+i+"}}":r="{{hit-mark-stop}}",t=t.slice(0,e.index)+r+t.slice(e.index)}),t=t.replace(/\n({{hit-mark-stop}})?$/,`

$1`),t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=t.replace(/{{hit-mark-start\|(\d+)}}/g,function(e,i){const r=s[+i].className;if(r){let o='<mark class="'+r+'"';if(r==="word"){let l=n.slice(s[+i].index,s[+i-1].index);l=l.replace(/"/g,"&quot;"),o+=' data-word="'+l+'"'}return o+">"}else return"<mark>"}),t=t.replace(/{{hit-mark-stop}}/g,"</mark>"),t+='<mark class="placeholder"> \u26A1 </mark>',this.highlights.innerHTML=t,this.el.dispatchEvent(new CustomEvent("highlights-updated"))},handleScroll:function(){this.backdrop.scrollTop=this.el.scrollTop;let s=this.el.scrollLeft;s>0?this.backdrop.style.transform="translateX("+-s+"px)":this.backdrop.style.transform=""},blockContainerScroll:function(){this.container.scrollLeft=0},destroy:function(){this.container.parentElement.replaceChild(this.el,this.container),this.el.classList.remove(this.ID+"-content",this.ID+"-input")}};export{I as H,w as T,P as n};
