import{b as g}from"./constant-CWUMdlVX.js";import{l as d}from"./logger-BTW-zIW3.js";import{c as z}from"./index.browser-CJrp5d7n.js";import{a as A,g as F,c as K,k as L,j as R,p as V,h as I,l as U,e as B,q as _,m as G,S as J}from"./_initCloneObject-BrGMl3JF.js";import{d as M,c as X,e as j,f as Q,i as C,h as Y}from"./_MapCache-IKV2IqD2.js";import{a as v,i as O,b as Z}from"./isObject-B0rSZd8A.js";import"./index-BbP3371Q.js";function P(t){return t}function tt(t,r,e){switch(e.length){case 0:return t.call(r);case 1:return t.call(r,e[0]);case 2:return t.call(r,e[0],e[1]);case 3:return t.call(r,e[0],e[1],e[2])}return t.apply(r,e)}var et=800,rt=16,nt=Date.now;function it(t){var r=0,e=0;return function(){var n=nt(),a=rt-(n-e);if(e=n,a>0){if(++r>=et)return arguments[0]}else r=0;return t.apply(void 0,arguments)}}function at(t){return function(){return t}}var st=M?function(t,r){return M(t,"toString",{configurable:!0,enumerable:!1,value:at(r),writable:!0})}:P,ot=it(st),H=Math.max;function lt(t,r,e){return r=H(r===void 0?t.length-1:r,0),function(){for(var n=arguments,a=-1,i=H(n.length-r,0),s=Array(i);++a<i;)s[a]=n[r+a];a=-1;for(var o=Array(r+1);++a<r;)o[a]=n[a];return o[r]=e(s),tt(t,this,o)}}function ct(t,r){return ot(lt(t,r,P),t+"")}function ut(t,r,e){if(!v(e))return!1;var n=typeof r;return(n=="number"?A(e)&&X(r,e.length):n=="string"&&r in e)?j(e[r],t):!1}function dt(t){return ct(function(r,e){var n=-1,a=e.length,i=a>1?e[a-1]:void 0,s=a>2?e[2]:void 0;for(i=t.length>3&&typeof i=="function"?(a--,i):void 0,s&&ut(e[0],e[1],s)&&(i=a<3?void 0:i,a=1),r=Object(r);++n<a;){var o=e[n];o&&t(r,o,n,i)}return r})}var mt="[object Object]",pt=Function.prototype,ft=Object.prototype,N=pt.toString,gt=ft.hasOwnProperty,bt=N.call(Object);function ht(t){if(!O(t)||Z(t)!=mt)return!1;var r=F(t);if(r===null)return!0;var e=gt.call(r,"constructor")&&r.constructor;return typeof e=="function"&&e instanceof e&&N.call(e)==bt}function vt(t){return function(r,e,n){for(var a=-1,i=Object(r),s=n(r),o=s.length;o--;){var l=s[++a];if(e(i[l],l,i)===!1)break}return r}}var wt=vt();function w(t,r,e){(e!==void 0&&!j(t[r],e)||e===void 0&&!(r in t))&&Q(t,r,e)}function yt(t){return O(t)&&A(t)}function y(t,r){if(!(r==="constructor"&&typeof t[r]=="function")&&r!="__proto__")return t[r]}function kt(t){return K(t,L(t))}function Tt(t,r,e,n,a,i,s){var o=y(t,e),l=y(r,e),x=s.get(l);if(x){w(t,e,x);return}var c=i?i(o,l,e+"",t,r,s):void 0,m=c===void 0;if(m){var b=C(l),h=!b&&R(l),E=!b&&!h&&V(l);c=l,b||h||E?C(o)?c=o:yt(o)?c=I(o):h?(m=!1,c=U(l,!0)):E?(m=!1,c=B(l,!0)):c=[]:ht(l)||_(l)?(c=o,_(o)?c=kt(o):(!v(o)||Y(o))&&(c=G(l))):m=!1}m&&(s.set(l,c),a(c,l,n,i,s),s.delete(l)),w(t,e,c)}function q(t,r,e,n,a){t!==r&&wt(r,function(i,s){if(a||(a=new J),v(i))Tt(t,r,s,e,q,n,a);else{var o=n?n(y(t,s),i,s+"",t,r,a):void 0;o===void 0&&(o=i),w(t,s,o)}},L)}var u=dt(function(t,r,e){q(t,r,e)});const S=()=>z("1234567890abcdefghijklmnopqrstuvwxyz",6)();function k(){let t=S();for(;t.match(/^\d/);)t=S();return`windpress${t}`}function xt(t){const r=[];return t.childNodes.forEach(e=>{const n=D(e);n&&r.push(n)}),$(r,0)}function Et(t){const r=t.tagName.toLowerCase(),e={id:k(),name:"div",settings:{tag:r},children:[]},n=[],a=["id","class","href","src"];if(Object.keys(t.attributes).forEach(i=>{const s=t.attributes[i].name;a.includes(s)?(s==="class"&&t.attributes[i].value.trim()!==""&&u(e.settings,{_cssClasses:t.attributes[i].value}),s==="id"&&t.id.trim()!==""&&u(e.settings,{_cssId:t.id}),s==="href"&&t.tagName.toLowerCase()==="a"&&u(e.settings,{link:{url:t.getAttribute("href")}})):n.push({id:k(),name:s,value:t.attributes[i].value})}),u(e.settings,{_attributes:n}),r==="svg")return e.name="svg",u(e.settings,{source:"code",code:t.outerHTML}),e.settings._attributes=[],e;if(r==="img"){let i=t.getAttribute("src");return e.name="image",u(e.settings,{image:{external:!0,url:i||"",full:i||"",filename:i.split("/").pop()||""},altText:t.getAttribute("alt")||""}),delete e.settings.tag,e}if(r.match(/h[1-6]/)&&(e.name="heading",u(e.settings,{text:t.innerText,tag:r})),r==="video"||r==="iframe"&&(t.getAttribute("src").includes("youtube.com")||t.getAttribute("src").includes("vimeo.com")))return e.name="video",u(e.settings,{source:"url",url:r==="video"?t.getAttribute("src"):t.getAttribute("src").split("?")[0]}),delete e.settings.tag,e;if(r==="a"){if(u(e.settings,{link:{type:"external",url:t.getAttribute("href")||"",newTab:t.getAttribute("target")==="_blank",ariaLabel:t.getAttribute("aria-label")||"",title:t.getAttribute("title")||"",rel:t.getAttribute("rel")||""}}),t.children.length===0)return e.name="text-basic",u(e.settings,{text:t.innerText}),e;u(e.settings,{text:t.innerText})}return t.childNodes.forEach(i=>{const s=D(i);s&&e.children.push(s)}),e}function D(t){return t.nodeType===Node.ELEMENT_NODE?Et(t):t.nodeType===Node.TEXT_NODE&&t.nodeValue.trim()!==""?{id:k(),name:"text-basic",settings:{tag:"span",text:t.nodeValue},children:[]}:null}function $(t,r){const e=[];return t.forEach(n=>{n.parent=r,n._children=n.children.map(a=>a.id),e.push(n),e.push(...$(n.children,n.id)),n.children=n._children,delete n._children}),e}async function At(){if(!navigator.permissions)return d("Clipboard permissions not supported",{module:"html2bricks",type:"error"}),!1;let t="";const r=await navigator.permissions.query({name:"clipboard-read",allowWithoutGesture:!1});if(r.state==="prompt"&&(d("Requesting clipboard-read permission",{module:"html2bricks"}),t=await navigator.clipboard.readText(),r.state!=="granted"))return d("Clipboard-read permission denied",{module:"html2bricks",type:"error"}),!1;t=await navigator.clipboard.readText();const e=await navigator.permissions.query({name:"clipboard-write"});return e.state==="prompt"&&(d("Requesting clipboard-write permission",{module:"html2bricks"}),await navigator.clipboard.writeText(t),e.state!=="granted")?(d("Clipboard-write permission denied",{module:"html2bricks",type:"error"}),!1):!0}async function T(){if(!await At()){g.$_showMessage("[WindPress] Clipboard access not available");return}const t=(await navigator.clipboard.readText()).trim();if(!t||t.charAt(0)!=="<"){d("Pasted content is not HTML",{module:"html2bricks",type:"error"}),g.$_showMessage("[WindPress] Pasted content is not HTML");return}const r=new DOMParser().parseFromString(t,"text/html").body,e={content:xt(r),source:"bricksCopiedElements",sourceUrl:window.bricksData.siteUrl,version:window.bricksData.version,globalClasses:[],globalElements:[]};await navigator.clipboard.writeText(JSON.stringify(e,null)),g.$_pasteElements(),g.$_showMessage("[WindPress] HTML pasted"),await navigator.clipboard.writeText(t)}document.addEventListener("keydown",t=>{t.target.id==="bricks-toolbar"||t.target.id==="bricks-panel"||!(t.ctrlKey||t.metaKey)||!t.shiftKey||t.key.toLowerCase()!=="v"||T()});const W=document.querySelector("#bricks-builder-context-menu li:nth-child(2)"),p=document.createElement("li");p.id="windpressbricks-html2bricks-context-menu",p.classList.add("sep"),p.innerHTML='<span class="label">Paste HTML</span><span class="shortcut">CTRL + SHIFT + V</span>',p.addEventListener("click",T),W.classList.remove("sep"),W.insertAdjacentElement("afterend",p);const Lt=document.querySelector('#bricks-panel-header>ul.actions>li[data-balloon="Paste (All)"]'),f=document.createElement("li");f.dataset.balloon="Paste HTML",f.dataset.balloonPos="bottom-right",f.innerHTML=`
    <span class="bricks-svg-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-html5" fill="none" stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M20 4l-2 14.5l-6 2l-6 -2l-2 -14.5z" /><path d="M15.5 8h-7l.5 4h6l-.5 3.5l-2.5 .75l-2.5 -.75l-.1 -.5" /></svg>
    </span>
`,f.addEventListener("click",T),Lt.insertAdjacentElement("afterend",f),d("Module loaded!",{module:"html2bricks"});
