import{i as Ve,l as ze,r as De,b as Me,L as Oe,_ as R,T as je,P as Fe,K as Be,M as Re,N as Ue,O as He,__tla as Ke}from"./_plugin-vue_export-helper-B7AYZ_fF.js";import{l as q}from"./logger-BTW-zIW3.js";import{d as Z,b as U,a as Ne}from"./constant-CWUMdlVX.js";import{i as _,a as ee,q as H,u as K,v as b,x as m,y as w,z as E,A as I,C as T,F as Xe,r as $,w as W,S as te,J as P,K as C,E as V,M as z,Q as D,B as N,G as Ye,H as Ge,D as Je,T as Qe,n as Ze}from"./runtime-core.esm-bundler-CuuCWbwv.js";import{_ as et}from"./lib-FVFXNsp8.js";import{__tla as tt}from"./build-6XnEkjQY.js";import{__tla as ot}from"./oxide_parser_wasm-8nf_WcM4.js";import{g as rt}from"./intellisense-DggKt6it.js";import{a as at}from"./index-BtL5O8vF.js";import{s as lt}from"./set-qX46P2hw.js";import"./index-BHzFOpFs.js";import"./isObject-B5R9K1Pz.js";import"./preload-helper-Tcd9XBoB.js";import"./_MapCache-C7aBjWBU.js";import"./isSymbol-DJmTqBMq.js";Promise.all([(()=>{try{return Ke}catch{}})(),(()=>{try{return tt}catch{}})(),(()=>{try{return ot}catch{}})()]).then(async()=>{Ve({scope:"#windpressbricks-variable-app",rootSize:10}),ze.add(De,Me);const oe={id:"windpressbricks-variable-app-header",class:"bg:$(builder-bg) cursor:grab bb:1|solid|$(builder-border-color)"},re={class:"flex gap:10 align-items:center"},ae={class:"flex align-items:center px:12 py:2"},le={class:"font:bold gap:10 text:center flex-grow:1 align-items:center cursor:default px:12 py:2"},ne={__name:"PanelHeader",setup(a){const t=_("variableApp"),o=_("isOpen");function y(){const c=t.querySelector("#windpressbricks-variable-app-header");let p=$(!1),f=0,d=0;W(p,n=>{n?(document.body.style.userSelect="none",Z.style.pointerEvents="none",c.style.cursor="grabbing"):(document.body.style.removeProperty("user-select"),Z.style.removeProperty("pointer-events"),c.style.cursor="grab")});const s=n=>{p.value=!0;const l=c.getBoundingClientRect();f=n.clientX-l.left,d=n.clientY-l.top};c.removeEventListener("mousedown",s),c.addEventListener("mousedown",s);const u=n=>{if(!p.value)return;const l=c.getBoundingClientRect(),e=n.clientX,r=n.clientY,v=e-f,i=r-d,g=v<0?0:v>window.innerWidth-l.width?window.innerWidth-l.width:v,k=i<0?0:i>window.innerHeight-l.height?window.innerHeight-l.height:i;t.style.left=`${g}px`,t.style.top=`${k}px`};document.removeEventListener("mousemove",u),document.addEventListener("mousemove",u);const h=n=>{p.value=!1};document.removeEventListener("mouseup",h),document.addEventListener("mouseup",h)}return ee(()=>{y()}),(c,p)=>{const f=H("inline-svg"),d=H("font-awesome-icon"),s=K("tooltip");return b(),m("div",oe,[w("div",re,[w("div",ae,[E(f,{src:I(Oe),class:"inline-svg fill:current font:24"},null,8,["src"])]),T((b(),m("div",le,[Xe(" WindPress ")])),[[s,{placement:"top",content:`v${c.windpressbricks._version}`}]]),T((b(),m("button",{onClick:p[0]||(p[0]=u=>o.value=!I(o)),class:"flex align-items:center py:10 px:12 bg:transparent bg:$(builder-bg-accent):hover"},[E(d,{icon:["fas","xmark"],class:"fg:$(builder-color)"})])),[[s,{placement:"top",content:"Close"}]])])])}}},se={class:"flex-grow:1"},ie={key:0,class:"expansion-panel__body"},ce={__name:"ExpansionPanel",props:{namespace:{type:String,required:!0},name:{type:String,required:!0}},setup(a,{expose:t}){const o=a,y=$(null),c=at(`windpressbricks-variable-app.ui.expansion-panels.${o.namespace}`,{[`${o.name}`]:!1},void 0,{mergeDefaults:!0});function p(d){c.value[o.name]=d===null?!c.value[o.name]:d}function f(){y.value.scrollIntoView()}return t({togglePanel:p,scrollIntoView:f}),(d,s)=>{const u=H("font-awesome-icon");return b(),m("div",{ref_key:"sectionRef",ref:y,class:"expansion-panel mx:10 py:8 mr:4"},[w("div",{onClick:s[0]||(s[0]=h=>I(c)[a.name]=!I(c)[a.name]),class:P([{},"expansion-panel__header flex justify-content:space-between p:10 r:8 cursor:pointer"])},[w("div",se,[te(d.$slots,"header",{},void 0,!0)]),w("div",null,[E(u,{icon:["fas","chevron-right"],class:P([{"rotate(-90)":I(c)[a.name]},"~duration:300 font:18"])},null,8,["class"])])]),E(je,null,{default:C(()=>[I(c)[a.name]?(b(),m("div",ie,[te(d.$slots,"default",{},void 0,!0)])):V("",!0)]),_:3})],512)}}},M=R(ce,[["__scopeId","data-v-5e77b5af"]]),ue={class:"{m:10;pb:15}>div"},pe={class:"variable-section-title font:14 my:10"},de={class:"variable-section-items flex flex:row gap:8 flex-wrap:wrap"},ve=["onClick","onMouseenter"],be={class:"font:14"},me=1e3,X={__name:"CommonVariableItems",props:{variableItems:{type:Object,required:!0}},setup(a){const t=_("focusedInput"),o=_("recentVariableSelectionTimestamp"),y=_("tempInputValue");function c(d,s){performance.now()-o.value<me||t.value&&(t.value.value=`var(${s})`,t.value.dispatchEvent(new Event("input")),t.value.focus())}function p(d){!t.value||y.value===null||(t.value.value=y.value,t.value.dispatchEvent(new Event("input")),t.value.focus())}function f(d,s){t.value&&(t.value.value=`var(${s})`,t.value.dispatchEvent(new Event("input")),t.value.focus(),y.value=`var(${s})`,o.value=performance.now())}return(d,s)=>{const u=K("tooltip");return b(),m("div",ue,[(b(!0),m(z,null,D(a.variableItems,(h,n)=>(b(),m("div",{key:n,class:""},[w("div",pe,N(n.replace("_","-")),1),w("div",de,[h.length>0?(b(!0),m(z,{key:0},D(h,(l,e)=>T((b(),m("button",{key:e,onClick:r=>f(r,l.key),onMouseenter:r=>c(r,l.key),onMouseleave:p,class:"px:12 py:8 r:$(builder-border-radius) fg:$(builder-color) bg:$(builder-bg-2) bg:$(builder-bg-3):hover b:0 flex-grow:1 flex-shrink:1 flex-basis:30% text:center {opacity:.5;font:semibold}>span opacity:100:hover>span"},[w("span",be,N(l.label),1)],40,ve)),[[u,{placement:"top",content:`var(${l.key}, ${l.value})`}]])),128)):V("",!0)])]))),128))])}}};function O(){var t,o;if(U.$_state.activePanel!=="element")return null;const a=(t=U.$_state)==null?void 0:t.activeElement.id;return(o=U.$_getIframeDoc())==null?void 0:o.getElementById(`brxe-${a}`)}function ye({selector:a,callback:t,options:o}){const y=new MutationObserver(t),c=document.querySelector(a);if(!c){q(`Target not found for selector: ${a}`,{module:"variable-picker",type:"error"});return}const p={childList:!0,subtree:!0};y.observe(c,Object.assign(Object.assign({},p),o))}const fe={class:"{m:10;pb:15}>div"},ge={class:"variable-section-title font:14 my:10"},he={key:0,class:"variable-section-items"},ke=["onClick","onMouseenter"],we=["onClick","onMouseenter"],_e=1e3,Ee={__name:"ColorVariableItems",props:{variableItems:{type:Object,required:!0}},setup(a){const t=_("focusedInput"),o=_("recentColorPickerTarget"),y=_("recentVariableSelectionTimestamp"),c=_("tempInputValue");function p(n,l){var e;if(!(performance.now()-y.value<_e)){if(!t.value){const r=O();if(!r)return;const v=[{property:"color",control:"typography"},{property:"backgroundColor",control:"background"},{property:"borderColor",control:"border"}];for(const{property:i,control:g}of v)(e=o.value)!=null&&e.closest(`[data-control="${g}"]`)&&(r.style[i]=`var(${l})`);return}t.value.value=`var(${l})`,t.value.dispatchEvent(new Event("input")),t.value.focus()}}function f(n){var l;if(!t.value||c.value===null){const e=O();if(!e)return;const r=[{property:"color",control:"typography"},{property:"backgroundColor",control:"background"},{property:"borderColor",control:"border"}];for(const{property:v,control:i}of r)(l=o.value)!=null&&l.closest(`[data-control="${i}"]`)&&(e.style[v]="");return}t.value.value=c.value,t.value.dispatchEvent(new Event("input")),t.value.focus()}function d(n,l){if(n.stopPropagation(),n.preventDefault(),!t.value){const e=o.value;h(l),y.value=performance.now(),setTimeout(()=>{const r=O();if(!r)return;const v=[{property:"color",control:"typography"},{property:"backgroundColor",control:"background"},{property:"borderColor",control:"border"}];for(const{property:i,control:g}of v)e!=null&&e.closest(`[data-control="${g}"]`)&&(r.style[i]="")},5);return}t.value.value=`var(${l})`,t.value.dispatchEvent(new Event("input")),t.value.focus(),c.value=`var(${l})`,y.value=performance.now()}function s(){document.querySelectorAll(".windpressbricks-variable-app-colorpopup").forEach(n=>{n.remove()})}function u(){if(document.querySelector(".windpressbricks-variable-app-colorpopup"))return;const n=".bricks-control-popup { display: none !important; }",l=document.createElement("style");l.id="windpressbricks-variable-app-bricks-popup",l.appendChild(document.createTextNode(n)),l.classList.add("windpressbricks-variable-app-colorpopup"),document.head.appendChild(l)}async function h(n){var e,r,v,i,g;u(),document.querySelector(".bricks-control-popup .color-palette.grid")||((r=(e=o.value)==null?void 0:e.closest(".bricks-control-preview"))==null||r.click(),await new Promise(k=>setTimeout(k,25)));const l=document.querySelector(".bricks-control-popup .color-palette.grid");l?(i=(v=l.querySelector(`[data-balloon="var(${n})"]`))==null?void 0:v.parentElement)==null||i.click():q("Failed to select color. Color grid not found.",{module:"variable-picker",type:"error"}),(g=document.querySelector("body"))==null||g.click(),await new Promise(k=>setTimeout(k,2)),document.querySelector(".bricks-control-popup")?(setTimeout(()=>{var k;(k=document.querySelector("body"))==null||k.click(),setTimeout(()=>{s()},5)},5),q("Failed to close color picker. Delaying close.",{module:"variable-picker",type:"error"})):s()}return(n,l)=>{const e=K("tooltip");return b(),m("div",fe,[(b(!0),m(z,null,D(a.variableItems,(r,v)=>(b(),m("div",{key:v,class:""},[w("div",ge,N(v),1),r.DEFAULT?(b(),m("div",he,[T(w("button",{onClick:i=>d(i,r.DEFAULT.key),onMouseenter:i=>p(i,r.DEFAULT.key),onMouseleave:f,class:P([`bg:$(${r.DEFAULT.key.slice(2)})`,"w:full r:4 h:24 border:1|solid|transparent border:white:hover"])},null,42,ke),[[e,{placement:"top",content:`var(${r.DEFAULT.key}, ${r.DEFAULT.value})`}]])])):V("",!0),r.shades&&Object.keys(r.shades).length>0?(b(),m("div",{key:1,class:P([[{},Object.keys(r.shades).length>1?"rl:4>div:first-child>button rr:4>div:last-child>button":"",`grid-template-cols:repeat(${Object.keys(r.shades).length},auto)`],"variable-section-items grid r:4 overflow:hidden"])},[(b(!0),m(z,null,D(r.shades,(i,g)=>(b(),m("div",{key:g,class:"flex gap:10"},[T(w("button",{onClick:k=>d(k,i.key),onMouseenter:k=>p(k,i.key),onMouseleave:f,class:P([`bg:$(${i.key.slice(2)})`,"w:full h:24 border:1|solid|transparent border:white:hover"])},null,42,we),[[e,{placement:"top",content:`var(${i.key}, ${i.value})`}]])]))),128))],2)):V("",!0)]))),128))])}}},j=a=>(Ye("data-v-49cb1850"),a=a(),Ge(),a),$e={id:"windpressbricks-variable-app-body",class:"rel w:full h:full overflow-y:scroll! bb:1|solid|$(builder-border-color)>div:not(:last-child)"},xe=j(()=>w("span",{class:"font:semibold"},"Color",-1)),Ce=j(()=>w("span",{class:"font:semibold"},"Typography",-1)),Ie=j(()=>w("span",{class:"font:semibold"},"Sizing",-1)),Se={__name:"PanelBody",setup(a){const t=$({colors:{},typography:{},sizing:{}}),o=_("focusedInput"),y=_("recentColorPickerTarget");async function c(){const s=await Ne.contentWindow.wp.hooks.applyFilters("windpress.module.design_system.main_css"),u=rt(et(s)),h={};u.filter(e=>e.key.startsWith("--color")).forEach(e=>{const r=e.key.slice(8),v=r.split("-");let i="";if(v.length>1){const g=v[0],k=v.slice(1).join("-");i=`${g}.shades.'${k}'`}else i=`${r}.DEFAULT`;lt(h,i,e)}),t.value.colors=Object.keys(h).sort().reduce((e,r)=>(e[r]=h[r],e),{});const n={font_size:[],line_height:[],letter_spacing:[]};u.filter(e=>e.key.startsWith("--font-size-")&&!e.key.endsWith("--line-height")).forEach(e=>{const r=e.key.slice(12);n.font_size.push({key:e.key,label:r,value:e.value})}),u.filter(e=>e.key.startsWith("--line-height-")||e.key.endsWith("--line-height")).forEach(e=>{const r=e.key.startsWith("--line-height-")?e.key.slice(14):e.key.slice(2,-13);n.line_height.push({key:e.key,label:r,value:e.value})}),n.line_height.sort((e,r)=>e.label.startsWith("font-size-")&&!r.label.startsWith("font-size-")?1:!e.label.startsWith("font-size-")&&r.label.startsWith("font-size-")?-1:0),u.filter(e=>e.key.startsWith("--letter-spacing-")).forEach(e=>{const r=e.key.slice(17);n.letter_spacing.push({key:e.key,label:r,value:e.value})}),t.value.typography=n;const l={spacing:[],width:[],breakpoint:[]};u.filter(e=>e.key.startsWith("--spacing-")).forEach(e=>{const r=e.key.slice(10);l.spacing.push({key:e.key,label:r,value:e.value})}),u.filter(e=>e.key.startsWith("--width-")).forEach(e=>{const r=e.key.slice(8);l.width.push({key:e.key,label:r,value:e.value})}),u.filter(e=>e.key.startsWith("--breakpoint-")).forEach(e=>{const r=e.key.slice(13);l.breakpoint.push({key:e.key,label:r,value:e.value})}),t.value.sizing=l}const p=$(null),f=$(null),d=$(null);return W(o,s=>{var u,h,n,l;if(s){const e=((h=(u=s.closest("[data-controlkey]"))==null?void 0:u.dataset.controlkey)==null?void 0:h.toLocaleLowerCase())??"",r=["typography","font"].some(g=>e.includes(g)),v=["padding","margin","gap","width","height"].some(g=>e.includes(g)),i=(l=(n=s.parentElement)==null?void 0:n.parentElement)==null?void 0:l.classList.contains("color-input");f.value.togglePanel(!1),d.value.togglePanel(!1),p.value.togglePanel(!1),i?(p.value.togglePanel(!0),p.value.scrollIntoView()):r?(f.value.togglePanel(!0),f.value.scrollIntoView()):v&&(d.value.togglePanel(!0),d.value.scrollIntoView())}}),W(y,s=>{s&&(p.value.togglePanel(!0),p.value.scrollIntoView())}),ee(()=>{c()}),new BroadcastChannel("windpress").addEventListener("message",async s=>{const u=s.data;u.source==="windpress/autocomplete"&&u.task==="windpress.main_css.saved.done"&&setTimeout(()=>{c()},1e3)}),(s,u)=>(b(),m("div",$e,[E(M,{namespace:"variable",name:"color",ref_key:"sectionColor",ref:p},{header:C(()=>[xe]),default:C(()=>[E(Ee,{variableItems:t.value.colors},null,8,["variableItems"])]),_:1},512),E(M,{namespace:"variable",name:"typography",ref_key:"sectionTypography",ref:f},{header:C(()=>[Ce]),default:C(()=>[E(X,{variableItems:t.value.typography},null,8,["variableItems"])]),_:1},512),E(M,{namespace:"variable",name:"spacing",ref_key:"sectionSpacing",ref:d,class:""},{header:C(()=>[Ie]),default:C(()=>[E(X,{variableItems:t.value.sizing},null,8,["variableItems"])]),_:1},512)]))}},Te=R(Se,[["__scopeId","data-v-49cb1850"]]),Pe={id:"windpressbricks-variable-app-container",class:"flex flex:column w:full h:full fg:$(builder-color) bg:$(builder-bg)"},Le={__name:"App",setup(a){const t=_("isOpen");return(o,y)=>T((b(),m("div",Pe,[E(ne),(b(),Je(Qe,null,{default:C(()=>[E(Te)]),_:1}))],512)),[[Fe,I(t)]])}},Ae=R(Le,[["__scopeId","data-v-382f3901"]]),L=document.createElement("windpressbricks-variable-app");L.id="windpressbricks-variable-app",document.body.appendChild(L);const S=$(!1),A=$(null),Y=$(null),F=$(null),qe=$(0),x=Be(Ae);x.config.globalProperties.windpressbricks=window.windpressbricks,x.provide("variableApp",L),x.provide("isOpen",S),x.provide("focusedInput",A),x.provide("tempInputValue",Y),x.provide("recentColorPickerTarget",F),x.provide("recentVariableSelectionTimestamp",qe),x.use(Re,{container:"#windpressbricks-variable-app"}),x.component("font-awesome-icon",Ue).component("inline-svg",He),x.mount("#windpressbricks-variable-app");function G(a){var t;!a.shiftKey||!a.target||((t=document==null?void 0:document.getSelection())==null||t.removeAllRanges(),a.preventDefault(),a.stopPropagation(),A.value=a.target,Y.value=a.target.value,S.value=!0)}function J(a){A.value=a.target}const We=['div[data-control="number"]',{selector:'div[data-control="text"]',hasChild:["#_flexBasis","#_overflow","#_gridTemplateColumns","#_gridTemplateRows","#_gridAutoColumns","#_gridAutoRows","#_objectPosition",'[id^="raw-"]']}];function Q(){setTimeout(()=>{We.forEach(a=>{(typeof a=="string"?[...document.querySelectorAll(a)]:[...document.querySelectorAll(a.selector)].filter(t=>a.hasChild.some(o=>t.querySelector(o)))).forEach(t=>{const o=t.querySelector("input[type='text']");(o==null?void 0:o.getAttribute("windpressbricks-variable-app"))!=="listened"&&(o==null||o.removeEventListener("click",G),o==null||o.addEventListener("click",G),o==null||o.removeEventListener("focus",J),o==null||o.addEventListener("focus",J),o==null||o.setAttribute("windpressbricks-variable-app","listened"),o==null||o.parentNode.setAttribute("data-balloon","Shift + click to open the Variable Picker"),o==null||o.parentNode.setAttribute("data-balloon-pos","bottom-right"))})}),[...document.querySelectorAll(".bricks-control-preview")].filter(a=>{var t,o;return((o=(t=a.closest(".control-inner"))==null?void 0:t.querySelector("label"))==null?void 0:o.getAttribute("for"))==="color"}).forEach(a=>{a.addEventListener("contextmenu",t=>{var o;!t.shiftKey||!t.target||(t.preventDefault(),t.stopPropagation(),(o=document==null?void 0:document.getSelection())==null||o.removeAllRanges(),A.value=null,S.value=!0,F.value=null,Ze(()=>{F.value=t.target}))})})},100)}let B=!1;ye({selector:"#bricks-panel-inner",options:{subtree:!0,childList:!0},callback(){B||(B=!0,Q(),setTimeout(()=>{B=!1},100))}}),Q(),document.addEventListener("keydown",a=>{a.key==="Escape"&&S.value&&(S.value=!1)}),W(S,a=>{L.style.zIndex=a?"calc(Infinity)":"-1"}),q("Module loaded!",{module:"variable-picker"})});
